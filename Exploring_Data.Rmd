---
title: "Exploratory Analysis"
output: 
  html_document:
    toc: true
    toc_float: true

---

This page gives a overview on investigating our dataset.

## Investigation based on borough

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(plotly)
library(patchwork)
library(kableExtra)
load("data/cleaned_data.RData")
```

```{r}
df = 
  transformed_rental_income %>% 
  separate(boro_block_lot, into = c("borough", "block", "lot"), sep = "-") %>% 
  mutate(
    borough = case_when(
      borough == "1" ~ "Manhattan",
      borough == "2" ~ "Bronx",
      borough == "3" ~ "Brooklyn",
      borough == "4" ~ "Queens",
      borough == "5" ~ "Staten Island")
    )
```

# Focus on amount and value
```{r }
df %>% 
  mutate(borough = fct_reorder(borough, full_market_value)) %>% 
  group_by(borough) %>%
  summarise(
    observations = n()
  ) %>%
  plot_ly(y = ~borough, 
          x = ~observations, 
          color = ~borough, 
          type = "bar", 
          colors = "viridis",
          orientation = 'h') %>%
  layout(title = 'Records in each Borough')
```


```{r}
df %>% 
  mutate(borough = fct_reorder(borough, full_market_value)) %>% 
  plot_ly(y = ~log(full_market_value), color = ~borough, type = "box", colors = "viridis") %>%
  layout(
    xaxis = list(title = 'Borough'),
    yaxis = list(title = 'log(Market value)')
  )
```
According to the histogram plot and box plot, we can see that the order of mean value is Manhattan, Queens, Brooklyn, Bronx and Staten Island from the highest to the lowest.
Both number and mean value of rentals in Manhattan take the head in five boroughs.

# Neighborhood with top 5 mean value
# Manhattan
```{r}
df %>% 
  filter(borough == 'Manhattan') %>% 
  group_by(neighborhood) %>% 
  summarise(mean_value = mean(full_market_value)) %>% 
  arrange(desc(mean_value)) %>%
  filter(mean_value >= 38299876) %>%
  knitr::kable() %>% 
  kable_styling(bootstrap_options = c("striped"))%>%
  kableExtra::kable_styling(font_size = 14)
```
# Bronx
```{r}
df %>% 
  filter(borough == 'Bronx') %>% 
  group_by(neighborhood) %>% 
  summarise(mean_value = mean(full_market_value)) %>% 
  arrange(desc(mean_value)) %>%
  filter(mean_value >= 8084000) %>%
  knitr::kable() %>% 
  kable_styling(bootstrap_options = c("striped"))%>%
  kableExtra::kable_styling(font_size = 14)
```

# Brooklyn
```{r}
df %>% 
  filter(borough == 'Brooklyn') %>% 
  group_by(neighborhood) %>% 
  summarise(mean_value = mean(full_market_value)) %>% 
  arrange(desc(mean_value)) %>%
  filter(mean_value >= 20216095) %>%
  knitr::kable() %>% 
  kable_styling(bootstrap_options = c("striped"))%>%
  kableExtra::kable_styling(font_size = 14)
```

# Queens
```{r}
df %>% 
  filter(borough == 'Queens') %>% 
  group_by(neighborhood) %>% 
  summarise(mean_value = mean(full_market_value)) %>% 
  arrange(desc(mean_value)) %>%
  filter(mean_value >= 36865727) %>%
  knitr::kable() %>% 
  kable_styling(bootstrap_options = c("striped"))%>%
  kableExtra::kable_styling(font_size = 14)
```

# Staten Island
```{r}
df %>% 
  filter(borough == 'Staten Island') %>% 
  group_by(neighborhood) %>% 
  summarise(mean_value = mean(full_market_value)) %>% 
  arrange(desc(mean_value)) %>%
  filter(mean_value >= 9450400) %>%
  knitr::kable() %>% 
  kable_styling(bootstrap_options = c("striped"))%>%
  kableExtra::kable_styling(font_size = 14)
```

## The proportion of each building classification

```{r}

c_df = as_tibble(table(df['building_classification']))
```

```{r}
plot_ly(c_df, labels = ~building_classification , values = ~n, type = 'pie')
```

```{r}
ddf = 
  df %>% 
  mutate(classification = substr(building_classification, 4, 12))

cc_df = as_tibble(table(ddf['classification']))
```

```{r}
plot_ly(cc_df, labels = ~classification , values = ~n, type = 'pie')
```



