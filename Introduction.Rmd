---
title: "Dataset Introduction"
output: 
  html_document:
    toc: true
    toc_float: true

---

To attain the price information of buildings, we use the dataset published by the Department of Finance of NYC. This dataset contains the income and expense statements of condominium as well as comparable  rental buildings in NYC that helps people to estimate the market value of their buildings. 

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(plotly)
library(patchwork)

load("E:/2023_autumn/DataScience/Final_Proj/data/cleaned_data.RData")
```

## Observations and Variables

After cleaning, our dataset have `r nrow(transformed_rental_income)` observations and `r ncol(transformed_rental_income)` variables. These observations are reported from 2012 to 2021 and covering the 5 boroughs of NYC.

```{r message=FALSE, warning=FALSE}
transformed_rental_income %>% 
  mutate(borough = fct_reorder(borough, full_market_value)) %>% 
  group_by(borough) %>%
  summarise(
    observations = n()
  ) %>%
  plot_ly(x = ~borough, y = ~observations, color = ~borough, type = "bar", colors = "viridis") %>%
  layout(title = 'Records in each Borough')
```
address to lat and long

```{r}
Manhattan_data = transformed_rental_income %>%
  filter(
    borough == "Manhattan"
  ) %>% 
  group_by(address) %>%
  summarise(
    times = n()
  ) %>%
  mutate(
    address = paste(address,"Manhattan",sep = ",")
  )

Manhattan_data$latlona = map(.x = Manhattan_data$address, ~ geocode(.x, output = "latlona", source = "google"))
save(Manhattan_data, file = "data/Manhattan_latlonmap.RData")
```



Some key variables are as follows:

- `Gross SqFt`: Gross square footage of the building
- `Estimated` Gross Income: Estimated Income per SquareFoot * Gross SquareFoot
- `Income per SqFt`: Estimated income per squarefoot of median comparable
- `Estimated Expense`: Estimated Expense per SquareFoot * Gross SquareFoot
- `Expense per SqFt`: Estimated expense per squarefoot of median comparab
- `Net Operating Income`: Estimated Gross Income-Estimated Expense
- `Full Market Value`: Current yearâ€™s total market value of the land and building
- `Market Value per SqFt`: Full Market Value/ Gross SquareFoot

```{r}

```


```{r message=FALSE, warning=FALSE}
box_value =  transformed_rental_income %>% 
  mutate(borough = fct_reorder(borough, full_market_value)) %>% 
  plot_ly(y = ~log(full_market_value), color = ~borough, type = "box", colors = "viridis") %>%
  layout(
    xaxis = list(title = 'Borough'),
    yaxis = list(title = 'log(Market value)')
  )


line_value_year = transformed_rental_income %>% 
  mutate(borough = fct_reorder(borough, full_market_value)) %>% 
  group_by(borough,report_year) %>% 
  summarise(mean_market_value = mean(full_market_value)) %>%
  plot_ly(x = ~ report_year, y = ~ mean_market_value, color = ~borough, type = "scatter",mode = 'lines', colors = "viridis",showlegend = F) %>%
  layout(
    xaxis = list(title = 'Year'),
    yaxis = list(title = 'Mean Market value')
  )


subplot(box_value, line_value_year, nrows = 2, titleY = TRUE, titleX = TRUE, margin = 0.1)
```

